#!/bin/bash
set -e

. jgb-helper
jgb_arch=$(uname -p)

while getopts  "bBp:" opt; do
  case ${opt} in
    b)
      extra="-b"
      ;;
    B)
      extra="-B"
      ;;
    p)
      jgb_arch=$OPTARG
      ;;
    ?)
      ;;
  esac
done

shift $((OPTIND - 1))
pk=$1

for m in Debug Release
do
    if [ -n "$pk" ] ; then
      jgb-src -R $pk
      pushd $pk > /dev/null
    fi
    jgb-build -Ri -p${jgb_arch} -t${m} -P $extra
    if [ -n "$pk" ] ; then
      popd > /dev/null
    fi
done
